# 更新日志
<!--
1. Telegram Web
2. `^\-` -> `-`
3. `[@bytimm](https://t.me/bytimm)` -> `@Sanhuaitang`
-->

## [13.9](https://resource.dopus.com/t/directory-opus-13-9/51950)
修复了 13.8 的一些问题。

### [13.9.1](https://resource.dopus.com/t/directory-opus-13-9-1-beta/51951)
文件窗口：
- 加强模式的按钮现在默认会被隐藏，可在 配置/文件显示模式/加强模式 中重新开启
- 文件夹树现在会将 文件夹/特殊文件夹 中的其它云文件夹与默认云文件夹显示在一起
- 微调默认主题

文件列表：
- 文件收集和库现在支持了 shell 列
- 添加 签名者 列，用于验证程序的签名
- 添加 流数 列，用于显示对应文件的 NTFS ADS 的数量
- 修复部分排序问题

文件操作：
- 支持在复制文件时去除“来自互联网”的标记，可通过 文件操作/复制文件/元数据/去除区域信息 进行设置，也可以通过 `Copy STRIPMOTW` 命令调用
- 图像转换器界面优化
- 修复了进行文件操作后文件窗口有时不响应鼠标/键盘输入的问题
- 修复了来自 Outlook 的拖放

查看器：
- 独立查看器支持在使用文本插件时通过 <kbd>Page Up</kbd>、<kbd>Page Down</kbd>、<kbd>Home</kbd> 和 <kbd>End</kbd> 进行控制
- 支持配置幻灯片是否使用淡入淡出动画
- 改进 WebP 图片探测

命令：
- `Copy WHENEXISTS=merge CREATEFOLDER` 支持压缩包
- `Copy QUEUE` 支持 `quiet` 和 `noisy` 参数
- `Go TABLOCK` 支持通过 `target` 来指定源文件夹标签
- 添加 `Set FOCUS=UtilityPane`，与 `Set UTILITY=Focus` 作用相同
- 修复了命令编辑器中的中文菜单的奇怪加速键

求值器：
- 添加 `Rnd` 函数
- 添加 `IsDir` 和 `IsFile` 函数
- 按钮中可以使用 `selbytes` 和 `totalbytes` 变量
- 按钮中可以在引用路径变量时通过添加 `#q` 后缀来自动添加双引号
- `@perfile` 块内可以通过 `preparse_dummy` 变量来检查是否在进行预解析

脚本：
- 添加 `OrderedMap`，可以保留插入顺序。脚本配置支持使用 `OrderedMap` 来指定各个配置项的顺序
- `FSUtil.OpenFile()` 支持占用文件，防止被其它程序读取或写入
- `FSUtil.Resolve()` 添加 `c` 标志，可以将 8.3 短路径转换为长路径
- 添加 `OnConfigBackup` 和 `OnConfigRestore` 事件
- 添加 `DOpus.FlushConfig()` 方法，支持强制保存当前编辑中的配置
- 对话框添加 `Dialog.singleton` 属性，可禁止多开对话框
- 对话框添加 `Dialog.state` 属性，用于获取对话框的显示状态；以及 `Dialog.WindowCmd()` 方法，可以改变显示状态

### [13.9.2](https://resource.dopus.com/t/directory-opus-13-9-2-beta/52020)
文件窗口：
- 默认文件菜单和文件夹标签页菜单中添加了恢复上个关闭窗口的命令
- 不再对文件上下文菜单自动分配加速键

脚本：
- 添加 `FSUtil.GetSignature()` 方法，可以获取程序的签名信息

### [13.9.3](https://resource.dopus.com/t/directory-opus-13-9-3-beta/52093)
文件窗口：
- 支持在复制标签页时复制所有状态，包括文件选择、展开文件夹、浏览历史，可在 配置/文件夹标签/文件夹标签栏 中设置
- 信息提示隐藏子句 `{!...} might be hidden... {!}` 现在支持多行
- 优化浮动工具栏外部图标读取

命令：
- 添加 `Go NEWTAB=dupe`，可完全复制标签页；`Go TABDUPLICATE` 添加 `full`、`nolock`、`nocolor` 参数
- `Go REFRESH` 添加 `expanded` 和 `noexpanded` 关键字
- `Go DRIVEBUTTONS`, `Go FOLDERCONTENT`, `Go FTPSITELIST`, `Favorites` 和 `Recent` 命令支持使用 `KEYARGS mmb:` 来修改生成的路径列表的中键单击动作，例如 `Go DRIVEBUTTONS KEYARGS mmb:NEW` 可以修改中键动作为打开新窗口，而不是打开新标签页
- `Select` 添加 `PATH` 参数，支持通过路径选择文件
- `Go` 添加 `TABGROUPDESC` 参数，支持为标签页组添加描述，可在保存标签页组时保存

求值器：
- 控制键添加 `ShowTips()`，支持显示提示信息
- 列添加 `HasLabel()`，支持判断文件是否含有指定标记

### [13.9.4](https://resource.dopus.com/t/directory-opus-13-9-4-beta/52202)
文件窗口：
- 现在在拖动到文件夹树上时会显示展开标记。
- 预览窗格现在会避免预览隐藏的 `~$*` 文件。解决 Microsoft 查看器在被要求查看 Microsoft 编辑器创建的临时文件时出现的错误。

命令：
- `Copy CREATEFOLDER` 使用的对话框现在具有与普通创建文件夹对话框相同的“读取新文件夹”选项（读取、读取到新标签等）。为 `Copy` 命令添加了 `READAUTO/K` 参数。
- 添加了 `Prefs POS` 参数。在打开配置、自定义和脚本对话框时可以用它来控制新窗口的位置。选项为 `lister`（在活动文件窗口上方打开）、`mouse`（在鼠标指针下方打开）或指定位置（例如 `POS=10,10`）。
- `Clipboard COPYCOLUMNS` 现在可以复制整个数据列，而无需先突出显示单元格（例如 `Clipboard COPYCOLUMNS=index:0/1/4,all` 将复制第 0、1 和 4 列的全部内容）。指定列索引而不使用 `all` 关键字将仅复制至少有一个单元格突出显示的项目的数据。
- 为 `Select` 命令添加了 `NOTCOPYING` 标志。将仅选择未参与复制作业（正在进行或排队）的文件。例如 `SELECT ALLFILES NOTCOPYING`。
- 通过 `Go TABGROUPLIST NEW` 打开新窗口现在会设置标题栏的标签组名称。

求值器：
- 高级过滤器控件现在可以匹配求值器列的值。
- 求值器 `Chr` 函数现在允许使用 CR（13）和 LF（10）。

脚本：
- 添加了 `Control.AddText`、`ModifyText` 和 `RemoveText` 方法。允许在脚本对话框中将覆盖文本添加到图像模式静态控件中。
- 添加了 `Command.DivertClipboard` 方法。允许将通常会进入剪贴板的文本（例如通过运行 `Clipboard COPYCOLUMNS` 命令）转移到 Opus 变量中。
- 添加了 `OnQuickFilterChange` 脚本事件。每当标签中的快速过滤器更改时（例如从过滤器栏），都会收到通知。
- 添加了脚本 `OnPeriodicTimer` 事件。允许脚本在可控的速率下定期调用 Opus。使用 `DOpus.SetTimer` 方法创建计时器，使用 `DOpus.KillTimer` 方法取消一个（或所有）计时器。
- 在脚本对话框中，`Tab` 控件支持了 `Control.RemoveItem`、`MoveItem`、`AddItem` 和 `InsertItemAt` 方法，可以动态地删除、移动和添加回标签页。所有标签页仍然必须像以前一样在对话框编辑器中添加，但一旦对话框创建，您就可以使用 `RemoveItem` 删除一个或多个页面，并在需要时稍后添加回来。
- `Control.GetItemByName` 和 `Control.GetItemAt` 现在也适用于 `Tab` 控件，以便通过其对话框的名称查找标签的索引（反之亦然）。
- 求值器现在将 `CRLF` 作为预定义值，扩展为包含回车符 + 换行符的字符串。

修复：
- 修复了复制标签页时未正确扩展子文件夹的问题。
- 当文件窗口具有自定义窗口边框时，迷你配置/迷你自定义工具栏不再被调整为与顶部工具栏行相同的高度，而是使用标准窗口边框的高度。
- 修复了在文件被单击/双击时，另一个窗口出现在 Opus 之上并在鼠标按钮被释放之前，以及然后点击文件列表中的某些元素时，内联重命名会开始。
- 修复了求值器 `Resolve()` 函数无法用于某些系统文件夹的问题。
- 修复了“记住标签的已展开项”在添加新标签后无法工作的问题。
- 修复了文件计数列触发从云存储下载压缩包文件的问题。
- 解决 Windows 错误，该错误可能会在最大化文本查看器后，鼠标刚刚越过滚动条时，将滚动条的一部分保留在文本查看器上。
- 可能修复了崩溃 ID 346。

## [13.8](https://resource.dopus.com/t/directory-opus-13-8/51888)
文件窗口：
- 正常状态栏配置现在会在已满的驱动器上显示硬盘空间
- 改进了中文版中上下文菜单的加速键分配
- 优化了打开含有大量文件夹标签的文件窗口时的性能

文件列表：
- 支持在刷新/前进后退时保留文件夹展开状态，配置位于 文件显示/文件夹展开 页中
- 支持配置对不能监控变化的文件夹（例如 WSL）自动定时刷新
- 支持禁用按 <kbd>Esc</kbd> 清空即时查找
- 支持禁用重命名时按 <kbd>Ctrl</kbd> 显示控制键或调整显示延迟
- 缩略图视图支持禁用选中文件时显示完整文件名
- 优化显示已缓存缩略图时的性能

文件操作：
- 元数据编辑器支持显示排序后的标签
- 支持配置在搜索时自动启动 Everything
- 过滤器现在可以搜索 EXIF 拍摄时间为空的图片

查看器：
- 查看器支持只显示图片的 R/G/B/A 通道
- 查看器在标题中的路径太长时会进行截短
- 支持在切换图片时显示淡入淡出动画，需要使用 `Show SLIDESHOW=fade` 命令

命令：
- 编辑器支持通过 <kbd>Ctrl+滚轮</kbd> 缩放字体
- 增加 `@color` 修饰符，可以使用求值器改变按钮的颜色
- 增加 `Set INFOTIPS`，可以对信息提示进行配置
- 增加 `Set UTILITY=float`，可以将脚本日志等窗格显示为悬浮窗口
- `Set BACKGROUNDIMAGE` 会在切换背景时使用淡入淡出动画，可以通过参数关闭
- `Go FOLDERCONTENT` 支持内嵌函数
- 求值器添加 `SysInfo("VerBuild")` 属性

脚本：
- 添加 `EverythingInterface` 对象，可以启动 Everything，进行搜索；也支持获取、设置、增加指定文件的 Everything 运行计数
- 添加 `Command.RunAsync` 和 `RunCommandAsync` 方法
- 增加 `Image.type` 属性
- 增加调色板控件
- 对话框支持开启最小化/最大化按钮
- 按钮支持响应右键事件
- 增加 `Dialog.WatchClipboard()` 方法和 `OnClipboardChange` 事件，可以监控剪贴板变化
- 增加 `Dialog.AddCustomMsg()`，可以在不同脚本间发送消息，以及 `Dialog.msgonly`，可以创建一个只用于接收消息的对话框
- 增加 `Tab.Notify()` 方法，可以向文件夹标签发送消息，显示在状态栏中
- 增加 `Dialog.FlushMsg()` 方法

## [13.7](https://resource.dopus.com/t/directory-opus-13-7/51467)
文件窗口：
- 支持将第一行工具栏显示到窗口标题栏中，选项位于 配置/工具栏/选项 中
  - 支持为标题栏工具栏单独配置颜色
  - 可以拖动任意工具栏的空白处移动窗口
  - 鼠标悬浮在窗口图标上会提示窗口标题
  - 增加了内置的窗口标题动态按钮
  - 支持显示配置/自定义按钮
- 空白按钮现在可以显示标签
- 标签按钮和空白按钮现在可以使用求值器来定义标签
- 文件窗口标题现在可以使用 `%F` 来显示选中文件的完整路径

文件列表：
- 支持通过光标悬浮来展开子文件夹，可在 文件显示/鼠标 中进行设置
- 允许对我的电脑中硬盘大小的单位进行设置（KB/MB/GB）

文件操作：
- 支持在文件收集中使用 Everything 搜索
- 现在可以按 Ctrl 键来显示可用的重命名控制键
- 行内重命名历史列表
  - 现在会在选中历史列表项目时更新文件名
  - 按回车键选定名称时不会进行重命名，可以进一步进行编辑
  - 按 Esc 键关闭列表时会还原文件名
  - 按 Ctrl+Z 会还原上一个选中的名称，而不是原始文件名
- 复制和新建快捷方式的文件名模板现在可以使用 `%3` 来插入不带括号的计数，也可以使用求值器来生成文件名
- 建议列表现在会在按 ↑ 键时选中最后一项，而不是第一项

查看器、VFS：
- 查看器支持通过内容识别 WebP 文件，即使扩展名不是 `.webp` 也可以正常显示
- 全屏查看器现在会在打开菜单时暂停播放幻灯片
- 即时查找和文本查看器的搜索支持了 Unicode 代理对（例如 emoji 和部分汉字）
- VFS 插件的描述现在会在行内显示

命令：
- `Set` 命令支持通过 `BACKGROUNDIMAGE` 和 `BACKGROUNDIMAGEOPTS` 参数来修改文件窗口背景
- 支持通过 `Set THUMBNAILBORDERS` 调整缩略图边框
- `Set AUTOSIZECOLUMNS` 支持了指定要调整的列
- 修复了 `Go` 和 `Help` 命令使用 F1 打开帮助时打开了错误的页面的问题

求值器：
- 函数中的求值器现在可以跨越多行
- 状态栏求值器现在可以使用 `dual` 变量来判断双栏
- 在工具栏中使用求值器时可以使用 `lister_title` 来获取窗口标题
- 求值器函数 `SysInfo()` 现在会返回版本号

脚本：
- 脚本添加了 `HTTPRequest` 对象
- 脚本方法 `FSUtil.ReadDir()` 支持通过选项来阻止读取加密压缩包时弹出密码输入框

  由 @Sanhuaitang 反馈
- 脚本支持通过 `//@@include` 来引用文件
- 脚本对话框按钮现在支持显示图标和关闭边框
- 修复 JS 引号转义高亮

其它：
- 修复了 搜狗/微信输入法 导致 Chrome 崩溃的问题

  https://t.me/IbDirectoryOpus/224

  由 @Cesaryuan 反馈
- 修复了向字体文件夹拖放字体进行安装时的崩溃问题
- 重新支持配置 HTTP 代理，但可能不支持大部分服务端，例如 Clash
- 重置上下文菜单时支持保留已有项目

### [13.7.1](https://resource.dopus.com/t/directory-opus-13-7-1-beta/51525)
<details>

文件列表：
- 支持在刷新/前进后退时保留文件夹展开状态，配置位于 文件显示/文件夹展开 页中
- 支持配置对不能监控变化的文件夹（例如 WSL）自动定时刷新
- 支持禁用按 Esc 清空即时查找
- 支持禁用重命名时按 Ctrl 显示控制键或调整显示延迟
- 缩略图视图支持禁用选中文件时显示完整文件名
- 优化显示已缓存缩略图时的性能

文件窗口：
- 查看器支持只显示图片的 R/G/B/A 通道
- 元数据编辑器支持显示排序后的标签
- 支持配置在搜索时自动启动 Everything
- 过滤器现在可以搜索 EXIF 拍摄时间为空的图片

命令：
- 编辑器支持通过 Ctrl+滚轮 缩放字体
- 增加 `@color` 修饰符，可以使用求值器改变按钮的颜色
- 增加 `Set INFOTIPS`，可以对信息提示进行配置
- 增加 `Set UTILITY=float`，可以将脚本日志等窗格显示为悬浮窗口
- `Go FOLDERCONTENT` 支持内嵌函数

脚本：
- 增加调色板控件
- 对话框支持开启最小化/最大化按钮
- 按钮支持响应右键事件
- 增加 `Dialog.WatchClipboard()` 方法和 `OnClipboardChange` 事件，可以监控剪贴板变化
- 增加 `Dialog.AddCustomMsg()`，可以在不同脚本间发送消息，以及 `Dialog.msgonly`，可以创建一个只用于接收消息的对话框
- 增加 `Tab.Notify()` 方法，可以向文件夹标签发送消息，显示在状态栏中
- 增加 `Image.type` 属性

</details>

### [13.7.2](https://resource.dopus.com/t/directory-opus-13-7-2-beta/51575)
<details>

文件窗口：
- 正常状态栏配置现在会在已满的驱动器上显示硬盘空间
- 改进了中文版中上下文菜单的加速键分配

查看器：
- 查看器在标题中的路径太长时会进行截短

脚本：
- 添加 `Dialog.FlushMsg()` 方法

其它：
- 修复了中文版中上下文菜单的显示异常（v13.7.1）

  https://resource.dopus.com/t/right-click-menu-text-display-error/51528

  由 @mingkingfox 反馈

</details>

## [13.6](https://resource.dopus.com/t/directory-opus-13-6/50656)
- 重复文件查找现在可以使用指定的列来进行识别，也就是说可以使用脚本/求值器来完全自定义重复文件的匹配
- 重复列模式现在支持使用索引搜索（Windows/Everything）

<!---->
- 在文件列表中重命名时，右键背景现在会弹出文件夹的上下文菜单，而不是正在重命名的文件的
- 过滤栏对于 `~(` 开头的模式会自动关闭任意匹配
- 文件类型统计现在不再使用多部位扩展名（例如 `.tar.gz`），而只使用最后一个部位（例如 `.gz`）
- 收藏栏现在可以直接拖动项目到子菜单，不需要先打开子菜单再拖动
- 文件夹树中，桌面现在可以被放在我的电脑里面，而不是单独的顶级节点
- 支持在主显示器上强制使用默认或指定色彩配置，需要在高级选项中设置

<!---->
- 求值器添加选中文件路径 `selpath` 变量
- 脚本配置支持浮点数

## [13.5](https://resource.dopus.com/t/directory-opus-13-5/50293)
部分更新内容：
- 即时查找的过滤栏模式现在默认开启部分匹配
- 在激活即时查找的范围选择模式时会自动显示序号列
- 即时查找的 DOS 和 WSL 模式现在会显示不同的图标

<!---->
- 独立查看器恢复置顶功能
- 独立查看器现在会在选取图片区域时显示坐标和大小

<!---->
- 创建文件夹对话框中，回车键不会再导致自动完成上屏，现在只需要按一次回车就可创建

<!---->
- 支持配置不同颜色来显示当前排序列

  https://resource.dopus.com/t/custom-color-for-sorted-column-header/49891
- 现在可以关闭当前文件夹标签周围的阴影了

<!---->
- 脚本函数（按钮）可以使用 `@include`
- 脚本现在可以获取所有 Shell 属性而不只是列属性
- 添加 `Tab.highlighted` 属性，可以获取文件夹标签页中有单元格被选中的文件（由白天反馈）

<!---->
- 修复了要打开用户文件夹并选中文件时的资源管理器替换

## [13.4](https://resource.dopus.com/t/directory-opus-13-4/49709)
部分更新内容：
- 标记支持删除线样式
- 过滤栏支持求值器（evaluator），可以使用类似 `size > 2gb` 和 `?bigfiles` 的语法
  
  https://resource.dopus.com/t/playground-using-the-evaluator-in-the-filter-bar/49510
- 创建文件夹对话框支持批量创建带序号的文件夹，例如 `第<001-100>个文件夹` 或 `第<100>个文件夹`
- 支持使用 7zip 插件而不是内置 zip 库来处理 zip 文件，默认不开启
- 支持 PNG 无损压缩
- 增加了 `@sendkey` 修饰符和 `DOpus.SendKey()` 方法，可用于模拟按键
- 修复了在配置窗口的搜索框中首次使用输入法输入时，第一个字符外或全部字符丢失的问题
  
  https://t.me/IbDirectoryOpus/147

## [13.3](https://resource.dopus.com/t/directory-opus-13-3/49331)

## [13.2](https://resource.dopus.com/t/directory-opus-13-3/49331)

## [13.1](https://resource.dopus.com/t/directory-opus-13-now-available/48103)
[→DOpus 13 Highlights 翻译](https://meta.appinn.net/t/topic/45255/10?u=chaoses_ib)

[DOpus 13 的在线使用手册](https://docs.dopus.com/doku.php?id=introduction)已更换 CMS 为 [DokuWiki](https://www.dokuwiki.org/dokuwiki)。

## [13.0](https://meta.appinn.net/t/topic/45255?u=chaoses_ib)
DOpus 13 部分更新内容：

界面：
- **支持暗色模式**
- **工具栏支持透明背景图片**
- 许多窗口调整了界面

文件列表：
- **支持自动保存文件夹格式**
- 支持使用 Everything 计算文件夹大小
- 支持文件夹配对（paired folders），在打开文件夹时自动打开预设的对应文件夹
- 支持为文件夹关联工具栏（folder toolbars）
- 文件夹标签支持设置线条颜色（color accents along their edges）
- 支持缩略图缩放模式（resize mode）和渲染风格（render style）
- 支持自定义求值列（Evaluator column）
- **手动排序支持保存多种顺序**
- 支持隐藏文件名的扩展名
- 文件夹格式支持不排序新文件
- 文件夹标签支持在过长时省略名称
- 文件夹树支持锁定文件夹展开

文件操作：
- **行内重命名支持快捷键调用预设**
- **文件夹标记（folder labels）**
- 定时查找文件夹？
- 支持单击文件图标打开文件
- 支持单击中键切换选中状态
- 单列窗口可同时作为 源 和 目的
- 支持进行文件类型（以及文件数量、文件大小）统计
- 修改文件属性时支持增减时间
- 图像转换支持保存预设和进行重命名
- 支持在操作文件时使用 Everything 进行文件计数

命令 & 脚本：
- **支持脚本实现/处理 FAYT（即时查找）命令**
- 新增了许多用于简化脚本编写的内置函数
- **新增了 **include file script**，可能是指将脚本作为库提供给其它脚本引用**
- 代码编辑框修复了 Unicode 文本光标偏移的问题（由 @laoqiuqiu 测试）
- 支持设置外部脚本编辑器
- 脚本相关界面变化
- 程序启动命令生成窗口界面变化，支持进行测试

其它：
- **增加 Shell 扩展和 Shell 属性设置**
- **支持定时备份打开的文件窗口**
- 改进 FTP 相关支持
- 在升级到 v13 时可以选择要升级的默认工具栏和菜单

注意，DOpus 13 目前仍在内测，以上更新内容是通过解包猜测得出的，如果将来发现报导上有偏差，我不负责。