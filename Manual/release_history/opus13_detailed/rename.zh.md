# Directory Opus 13 - 详细发行说明

# 名称更改

- 名称更改键：
  - （通过配置/“文件操作”/“重命名文件”/“控制键”配置）。
  - 现在，您可以配置在编辑文件名时选择或修改文件名部分的控制键。
  - 此功能主要用于内联重命名，但在大多数编辑文件名的位置都适用。
  - 键盘操作可以触发几种类型的操作：
    - 在高级重命名对话框中创建的重命名预设。
    - 正则表达式选择。
    - 求值器代码。
  - 以前硬编码的键现在通过此机制定义，允许您更改或删除它们。我们还添加了几个新的键：
    - （可能因键盘语言/布局而异。您可以通过配置查看和更改列表。）
    - <kbd>F2</kbd> -- 循环选择（词干、扩展名、全部）。
    - <kbd>Ctrl+A</kbd> -- 全选。
    - <kbd>Ctrl+D</kbd> -- 插入当前日期。
    - <kbd>Ctrl+E</kbd> -- 选择扩展名。
    - <kbd>Ctrl+F</kbd> -- 选择文件名词干（扩展名之外的所有内容）。
    - <kbd>Ctrl+L</kbd> -- 全部小写。
    - <kbd>Ctrl+N</kbd> -- 选择文件名词干（备用键）。
    - <kbd>Ctrl+P</kbd> -- 将第一个单词大写。
    - <kbd>Ctrl+S</kbd> -- 选择单词（每次按下均选择下一个单词）。
    - <kbd>Ctrl+U</kbd> -- 全部大写。
    - <kbd>Ctrl+W</kbd> -- 将所有单词大写。
    - <kbd>Ctrl+.</kbd> -- 将点和下划线替换为空格。
    - <kbd>Ctrl+/</kbd> -- 取父级文件名，保留扩展名。
    - <kbd>Ctrl+\[</kbd> -- 向左移动以“ - ”分隔的部分。
    - <kbd>Ctrl+\]</kbd> -- 向右移动以“ - ”分隔的部分。
    - <kbd>Ctrl+Shift+/</kbd> -- 取祖父母级文件名，保留扩展名。
  - 使用求值器代码的重命名键可以使用以下变量：
    - `name` -- 原文件名（编辑前）。
    - `namestem` -- 原文件名，不带扩展名。
    - `nameext` -- 原文件名的扩展名。
    - `dir` -- 如果正在重命名目录，则为 True，如果正在重命名文件，则为 False。
    - `exthidden` -- 如果当前隐藏文件扩展名，则为 True。
    - `path` -- 文件父目录的完整路径。
    - `value` -- 当前在编辑控件中的文件名。
    - `valstem` -- 编辑控件中的文件名，不带扩展名。
    - `valext` -- 编辑控件的扩展名。
    - `valleft` -- 第一个选定字符之前的所有内容。
    - `valsel` -- 所选范围内的所有内容。
    - `valright` -- 最后选定字符之后的所有内容。
    - `selstart` -- 第一个选定字符的索引。
    - `selend` -- 最后选定字符的索引。
    - 求值器代码可以返回一个字符串，它会更改编辑控件中的内容。
    - 求值器代码可以修改 selstart 和 selend 变量以更改选定字符串的部分，或定位光标。（Windows 编辑控件规则：如果 selstart 和 selend 具有相同的值，则它就是光标位置，并且选区宽度为零。）
    - 此上下文的求值器代码可以运行特殊的 RestoreExt 函数，如果编辑控件中隐藏了扩展名，则强制显示该扩展名。除了在所有地方都适用的标准求值器函数外，还提供了此函数。
- 内联重命名：
  - 内联重命名有一个弹出建议列表，该列表由以前重命名中使用的*单词*生成。
    - 除非关闭“自动建议弹出窗口”，否则在键入时会自动显示。
    - 始终可以通过按下 <kbd>Ctrl+Space</kbd> 显示它。
  - 内联重命名还会保留以前重命名的历史记录，如整个*文件名*，而不仅仅是单词。
    - 包含在键入时或 <kbd>Ctrl+Space</kbd> 出现的列表中。
    - 可以通过按下 <kbd>Ctrl+↑</kbd> 或 <kbd>Ctrl+↓</kbd> 单独显示它，而无需进行其他选择。（您还可以使用 <kbd>Shift</kbd> 替换 <kbd>Ctrl</kbd>。）
- 高级重命名：
  - 新选项，“即使模式不匹配也应用动作”。使“大写”等选项适用于所有项目，即使它们不匹配旧名称模式。
  - 新选项，“在预览中隐藏不受影响的项目”。
  - 在使用正则表达式时，名称字段会提供菜单，用于插入常用正则表达式代码，描述每个代码的作用，以帮助构建模式。
  - 在使用重命名将文件移至子文件夹时，现在将从目标路径的所有组件中去除前导和尾随空格（以及尾随点）。省去了您必须在正则表达式中删除它们等复杂操作。
  - 预设列表现在具有一个搜索字段。
  - 求值器代码可以用于新名称字段中。
    - 代码位于 `{=...=}` 中，类似于按钮、信息提示等中的求值器代码。
    - 允许您使用正则表达式操作父级路径名等。
    - //<Example://> `{=regex(parent, "(.*\([0-9]{4}\))", "\1")=}` 将从父文件夹名中提取所有内容，直到括号中包括一个四位数的年份。
  - 重命名对话框现在可以从当前设置创建函数（Opus 命令）。
    - 通过底部对话框中的剪贴板菜单访问。
    - 生成的命令既作为文本（用于粘贴到现有按钮中）和按钮格式（用于直接粘贴到工具栏中）复制到剪贴板。
    - 您还可以通过重命名预设列表中的项目及其上下文菜单生成命令。
- 命令：
  - `Rename APPLYNOMATCH` -- 类似于 UI 中的“即使模式不匹配也应用操作”。
  - `Rename AUTONUMBER` -- 旧“AUTORENAME”参数的新名称。（为了兼容性，两者继续工作。）
  - `Rename AUTONUMBER=force` -- 导致新文件从*第二个*文件开始重新编号，而不是从第一个文件开始。此外，该数字将自动置于名称末尾的括号中（除非使用了插入点）。
  - `Rename CASE=upper,extignore` -- 新的 `extignore` 标记允许更改名称大小写，同时保留扩展部分的旧大小写。
- 宏：
  - 宏现在可以将文件名部分大写和小写。
    - 一次编辑多个名称时，选择一个范围并按下 <kbd>Ctrl+U</kbd> 或 <kbd>Ctrl+L</kbd>。
    - 发出宏代码 U 和 L。
  - 手写宏的新宏代码：
    - 注意：自动宏生成器（多名称编辑）当前无法生成这些宏。它们只能手动输入。
    - P -- 使用前一个光标位置作为下一个锚点，而不是左右端点。当使用 P 时，锚点位置可以为负。例如，`L0+abc/P0+def` 将在名称的开头插入“abcdef”。
    - Wx -- 光标向左或向右移动 x 个单词（x 可以为正或负）。必须放在锚点/位置后面。如果锚点处于右边缘，则符号将颠倒。应用标准文件名分隔符。例如，`L0W2+abc` 将在名称中第三个单词的开头添加“abc”。
    - 要移动到第二个单词的末尾，请与 P 代码结合使用，从单词开头向后移动。例如，`L0W2/P-1+abc` 将在名称中第二个单词的末尾附加“abc”。
- 脚本：
  - 新的 `GetNewNameData.tab` 属性返回启动重命名的标签页，如果不存在则返回 `false`。
  - 具有重命名脚本的自定义字段更简单。现在，这些字段可以分配给自定义字段本身的属性，而不是使用单独的映射对象来处理标记和工具提示。（旧样式仍然可用，以便兼容。）\<WRAP\>
例如，可以使用以下格式来代替：

    getFieldData.fields.len = 999;
    getFieldData.field_labels("len") = "Uppercase Length";
    getFieldData.field_tips("len") = "Set length of string to uppercase";

你可以使用：

    getFieldData.fields.len = 999;
    getFieldData.fields.len.label = "Uppercase Length";
    getFieldData.fields.len.tip = "Set length of string to uppercase";

\</WRAP\>

      * 可通过设定最小/最大值来向数字编辑控件中添加向上/向下微调按钮：<WRAP>

    getFieldData.fields.len = 999;
    getFieldData.fields.len.label = "Uppercase Length";
    getFieldData.fields.len.max = 999;

\</WRAP\>

      * 你可以使用“limit”属性为文本编辑字段指定最大长度。

------------------------------------------------------------------------

下一步：[viewer](/Manual/release_history/opus13_detailed/viewer.zh.md)