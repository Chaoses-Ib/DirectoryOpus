# 同步

**同步**工具允许您同步两个文件夹的内容。所涉及的文件夹可以是 Opus 可以访问的任何位置 - 本地驱动器、压缩包、网络共享甚至 FTP 站点。您可以指定用于判断是否应该复制文件的条件，并且可以选择同步是单向还是双向。要访问同步工具，请从**工具**菜单中选择**同步**命令。

![](/Manual/images/media/13/sync_-_panel.png)

**同步**工具显示在文件窗口底部的**[实用程序面板](/Manual/basic_concepts/the_lister/utility_panel.zh.md)**中。

同步是一个两步过程：

- 首先运行**比较**阶段，该阶段会识别需要复制和/或删除的文件
- 其次，一旦您验证了比较阶段的结果是正确的，就会进行实际的**同步**

### 比较模式

面板的左半部分包含控制比较阶段的选项。

- **双向复制文件**：文件将在两个方向（*双向复制*）中复制。此模式中的比较仅仅基于文件修改日期 - 如果同一文件存在于两个位置，则较新的文件将覆盖较旧的文件。
- **从左向右复制文件**：文件将仅从左向右（或从**源位置**到**目标位置** - *单向复制*）复制。在此模式中，您可以选择用于确定是否需要更新文件的比较方法。

### 单向复制模式选项

在单向复制模式中，可以选择以下比较方法：

- **按字节比较**：按字节对目标文件夹中的文件与源文件进行比较，如果不同则替换。即使只有当两个文件具有相同大小时才会执行实际比较，但与其它选项相比，此模式仍然可能非常慢。
- **日期（不同）**：如果目标文件夹中的文件的最后修改时间戳与源文件的最后修改时间戳不同，则将替换该文件。
- **日期（不同）或大小**：如果文件的最后修改时间戳或大小与源文件的最后修改时间戳或大小不同，则将替换该文件。
- **日期（较新）**：如果源文件的最后修改时间戳较新于现有文件的最后修改时间戳，则将替换该文件。
- **日期（较新）或大小**：如果源文件的最后修改时间戳较新或者大小不同，则将替换该文件。
- **大小（不同）**：如果文件的大小与源文件的大小不同，则将替换该文件。
- **大小（较大）**：如果文件的大小与源文件的大小不同，则将替换该文件。
- **大小（较小）**：如果文件的大小与源文件的大小不同，则将替换该文件。

单向复制模式中可用的其它选项：

- **删除源位置中没有的目标位置中的文件**：如果文件不存在于源文件夹中，则从目标目录中删除文件。由于在这种模式下存在于一个文件夹中但不存在于另一个文件夹中的文件将被复制，因此此选项在双向复制模式中不可用。
- **复制前删除**：启用上述选项后，此选项会使 Opus 在复制操作之前而不是在复制操作之后执行删除操作。如果您担心目标驱动器空间不足，您可能需要使用此选项。

### 通用比较选项

在单向和双向模式下控制比较阶段的其它选项：

- **过滤器**：此选项允许您指定过滤器以控制要同步的文件。您可以直接输入 [通配符模式](/Manual/reference/wildcard_reference/pattern_matching_syntax.zh.md)，从下拉菜单中选择[预配置的过滤器](/Manual/preferences/preferences_categories/filtering_and_sorting/filters.zh.md)，或单击**定义**按钮以[定义新的过滤器](../../filtered_operations/README.zh.md)。
- **隐藏不受影响的文件**：如果启用此选项，则在执行比较时，将隐藏不需要同步（任一方向）的任何文件。当您有很大的目录树但可能只有少数需要同步的文件时，这非常方便 - 它可以让您更容易看到将要发生的事情。您还可以通过右键单击文件列表的背景并选择**隐藏不受影响的项**或**显示隐藏的项**上下文菜单命令来手动隐藏不受影响的文件（或再次显示它们）。
- **忽略一小时的时间差**：此选项启用夏令时补偿。某些文件系统（FAT/FAT32 以及某些 FTP 服务器）将时间戳存储为本地时间，而不是绝对 UTC 时间。这在实际操作中意味着当您的系统时钟在夏令时（夏季时间）的开始或结束时向前或向后更改一小时时，您的所有文件都会突然看起来像它们的时间戳已更改。如果您启用此选项，那么 Opus 将忽略恰好一小时的时间戳更改。
- **忽略秒**：在比较两个文件的时间戳时忽略秒。例如，启用此选项后，会将日期**21-Feb-2010 10:35:12**和**21-Feb-2010 10:35:38**视为相同。在不同位置之间执行同步时，这非常有用，这些位置无法以相同的精度存储时间戳（例如，一些 FTP 服务器根本不存储秒，如果没有此选项，您的文件几乎总看起来是过时的，即使它们不是过时的）。
- **仅比较现有文件**：通常，同步功能会复制不存在的文件以及已存在但不同的文件（基于所选的比较方法）。如果启用此选项，则仅复制已存在但不同的文件 - 将忽略两侧均不存在的文件。

### 同步位置

面板右侧的字段确定要同步哪些文件夹。根据**从左到右同步**选项，这些字段分别称为**源位置**和**目标位置**，或**左侧**和**右侧**。

当面板打开时，位置字段将默认为当前源位置和目标位置文件列表中的位置。

每个字段都有一个“链接”按钮，该按钮允许您将其链接到文件窗口中的当前位置。当该字段被链接时，每当您导航到一个新位置时，它都会自动更新 - 这可以让您使用文件窗口进行导航，而无需手动更新位置字段。

您可以使用每个字段的**浏览**按钮来选择其它位置，或手动输入路径。

位置字段右侧的**交换**按钮交换字段的值。

位置字段下方的选项是：

- **从左向右同步**：启用后，即使两个文件列表的实际源/目标状态相反，同步面板也会从左侧（或顶部）文件列表获取其源路径，并从右侧（或底部）文件列表获取其目标路径。启用此功能以防止意外地向错误的方向执行同步。当此功能关闭时，在右侧（或底部）文件列表中单击可能会导致同步向您预期的相反方向执行，除非您记住首先在左侧（或顶部）文件列表中再次单击。当然，在执行单向复制时，差异最为重要。
- **同步子文件夹内容：**如果您希望同步源文件夹和目标文件夹中的子文件夹内容，请启用此选项。如果您将其保持关闭状态，那么只有指定文件夹中的文件本身将被同步。
- **同步所有内容（包括隐藏文件）**：忽略源和目标中任何正在生效的过滤器，并同步所有文件，包括通常隐藏的所有文件。

### 排除位置

**排除**字段允许您指定操作中排除的文件夹。

![](/Manual/images/media/13/sync_exclude.png)

此字段允许您输入一个或多个路径、文件名或通配符模式。任何匹配的文件夹都将从操作中排除。在上面的屏幕截图中，名为 **.svn** 和 **.github** 的任何文件夹都将从同步中排除。

下拉菜单中的两个选项允许您自动将操作中隐藏的文件夹和系统文件夹排除在外。

### 执行比较

同步是一个分两步的过程——*比较*，然后是*同步*。Opus 比较源文件夹和目标文件夹并找出需要复制和/或删除的内容时，即进行比较阶段。

设置所需选项后，单击面板右下角的 **比较** 按钮开始比较。当您执行此操作时，Opus 遵循以下过程：

1. 如果列表检视器当前不在双栏模式，将打开第二个文件列表。
2. 源文件夹和目标文件夹将读入源文件列表和目标文件列表（如果它们尚未显示）。
3. 两个文件列表都将进入 [复选框模式](/Manual/basic_concepts/selecting_files/selecting_with_the_mouse_and_keyboard/checkbox_mode.zh.md) （实际上，这是仅用于同步和 [重复文件查找器](/Manual/additional_functionality/duplicate_file_finder.zh.md) 的复选框模式的特殊变体）。
4. 如果 **同步子文件夹内容** 选项已启用，两个文件列表都将进入 [平面视图（分组）](/Manual/basic_concepts/flat_view.zh.md) 模式，Opus 将读取所有子文件夹的内容。
5. 基于所选选项比较源文件夹和目标文件夹。此步骤可能需要一些时间，具体取决于涉及文件夹的大小。
6. 选择用于同步的文件和文件夹将用一系列标志在其复选框中表示，以表示将执行什么操作。
7. 如果 **隐藏未受影响的文件** 选项已启用，所有未选择进行同步的文件将从显示中删除。
8. 比较结果将总结在一个对话框中。

### 比较结果

![](/Manual/images/media/13/sync_-_compare1.png) 

此时，您可以单击 **同步** 按钮开始同步。但是，如果您想首先检查文件列表以查看将要发生的确切情况，或者您想更改所选用于同步的文件或比较选项，则可以单击 **关闭** 按钮返回列表检视器。然后，您将在文件列表中看到以下类型的显示。

### 检阅和更改同步操作

  
![](/Manual/images/media/13/sync_-_file_list.png) 

此屏幕截图对应于单向复制比较。已选择用于同步的文件用一系列标志标记，这些标志表示推荐的操作（复制、删除或无操作）。您可以通过简单地单击其复选框来更改对文件或文件夹的同步操作——您每次单击时，Opus 将循环浏览各种可用操作。

如果您正在处理大量文件，您可能希望从显示中删除已标记为不同步的文件。为此，请右键单击文件列表的背景，然后从上下文菜单中选择 **隐藏未受影响的项目** 命令。未标记为复制或删除的所有文件将从显示中删除。您可以使用 **显示隐藏的项目** 命令重新显示隐藏的文件。

### 比较错误

结果摘要对话框还将告知您在比较阶段遇到的任何错误。如果比较一侧的文件与另一侧的文件夹同名，则可能会出现错误。

如果出现冲突，同步过程将跳过相关的文件和文件夹——但如果您想进一步调查并纠正问题，您可以单击摘要对话框中显示的 **冲突**。这会将您返回到列表检视器，并为您突出显示冲突项。

### 执行同步

验证（并可能修改）同步操作后，您可以单击面板右下角的 **同步** 按钮开始同步。

如果您此时更改任何选项，**同步** 按钮将被禁用，您需要通过再次单击 **比较** 重新运行比较，然后才能继续进行同步。同步阶段一旦开始，它就会或多或少地以自动化操作进行。随着操作的进行，进度对话框将逐步浏览同步的各个部分（从源复制到目标，从目标复制到源，从目标删除）。